{"version":3,"sources":["webpack:///./assets/js/theme/gift-certificate.js","webpack:///./assets/js/theme/common/models/forms.js","webpack:///./assets/js/theme/common/utils/translations-utils.js","webpack:///./assets/js/theme/common/gift-certificate-validator.js"],"names":["GiftCertificate","context","validationDictionary","createTranslationDictionary","$certBalanceForm","$","purchaseModel","val","length","formModel","email","$purchaseForm","$customAmounts","find","purchaseValidator","nod","submit","delay","$element","min","data","minFormatted","max","maxFormatted","add","selector","validate","cb","numberVal","Number","errorMessage","message","amountRange","amountPlaceholders","updatedErrorText","forEach","placeholder","i","includes","replace","insertFormattedAmountsIntoErrorMessage","certificate_amount_range","toName","toEmail","fromName","fromEmail","triggeredBy","certTheme","get","checked","agreeToTerms","balanceVal","checkCertBalanceValidator","on","performCheck","areAll","event","preventDefault","click","modal","defaultModal","previewUrl","currentTarget","serialize","open","api","getPage","err","content","updateContent","previewError","wrap","$balanceForm","balanceValidator","giftCertChecker","PageManager","forms","value","test","password","this","notEmpty","isTranslationDictionaryNotEmpty","dictionary","Object","keys","activeDictionary","JSON","parse","chooseActiveDictionary","validationDictionaryJSON","validationFallbackDictionaryJSON","validationDefaultDictionaryJSON","localizations","values","map","key","split","pop","reduce","acc","cert"],"mappings":"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","file":"theme-bundle.chunk.0.js","sourcesContent":["import PageManager from './page-manager';\r\nimport nod from './common/nod';\r\nimport giftCertChecker from './common/gift-certificate-validator';\r\nimport formModel from './common/models/forms';\r\nimport { createTranslationDictionary } from './common/utils/translations-utils';\r\nimport { api } from '@bigcommerce/stencil-utils';\r\nimport { defaultModal } from './global/modal';\r\n\r\nexport default class GiftCertificate extends PageManager {\r\n    constructor(context) {\r\n        super(context);\r\n        this.validationDictionary = createTranslationDictionary(context);\r\n\r\n        const $certBalanceForm = $('#gift-certificate-balance');\r\n\r\n        const purchaseModel = {\r\n            recipientName(val) {\r\n                return val.length;\r\n            },\r\n            recipientEmail(...args) {\r\n                return formModel.email(...args);\r\n            },\r\n            senderName(val) {\r\n                return val.length;\r\n            },\r\n            senderEmail(...args) {\r\n                return formModel.email(...args);\r\n            },\r\n            customAmount(value, min, max) {\r\n                return value && value >= min && value <= max;\r\n            },\r\n            setAmount(value, options) {\r\n                let found = false;\r\n\r\n                options.forEach((option) => {\r\n                    if (option === value) {\r\n                        found = true;\r\n                        return false;\r\n                    }\r\n                });\r\n\r\n                return found;\r\n            },\r\n        };\r\n\r\n        const $purchaseForm = $('#gift-certificate-form');\r\n        const $customAmounts = $purchaseForm.find('input[name=\"certificate_amount\"]');\r\n        const purchaseValidator = nod({\r\n            submit: '#gift-certificate-form input[type=\"submit\"]',\r\n            delay: 300,\r\n        });\r\n\r\n        if ($customAmounts.length) {\r\n            const $element = $purchaseForm.find('input[name=\"certificate_amount\"]');\r\n            const min = $element.data('min');\r\n            const minFormatted = $element.data('minFormatted');\r\n            const max = $element.data('max');\r\n            const maxFormatted = $element.data('maxFormatted');\r\n            const insertFormattedAmountsIntoErrorMessage = (message, ...amountRange) => {\r\n                const amountPlaceholders = ['[MIN]', '[MAX]'];\r\n                let updatedErrorText = message;\r\n                amountPlaceholders.forEach((placeholder, i) => {\r\n                    updatedErrorText = updatedErrorText.includes(placeholder) ?\r\n                        updatedErrorText.replace(placeholder, amountRange[i]) :\r\n                        updatedErrorText;\r\n                });\r\n                return updatedErrorText;\r\n            };\r\n\r\n            purchaseValidator.add({\r\n                selector: '#gift-certificate-form input[name=\"certificate_amount\"]',\r\n                validate: (cb, val) => {\r\n                    const numberVal = Number(val);\r\n\r\n                    if (!numberVal) {\r\n                        cb(false);\r\n                    }\r\n\r\n                    cb(numberVal >= min && numberVal <= max);\r\n                },\r\n                errorMessage: insertFormattedAmountsIntoErrorMessage(this.validationDictionary.certificate_amount_range, minFormatted, maxFormatted),\r\n            });\r\n        }\r\n\r\n        purchaseValidator.add([\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"to_name\"]',\r\n                validate: (cb, val) => {\r\n                    const result = purchaseModel.recipientName(val);\r\n\r\n                    cb(result);\r\n                },\r\n                errorMessage: this.context.toName,\r\n            },\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"to_email\"]',\r\n                validate: (cb, val) => {\r\n                    const result = purchaseModel.recipientEmail(val);\r\n\r\n                    cb(result);\r\n                },\r\n                errorMessage: this.context.toEmail,\r\n            },\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"from_name\"]',\r\n                validate: (cb, val) => {\r\n                    const result = purchaseModel.senderName(val);\r\n\r\n                    cb(result);\r\n                },\r\n                errorMessage: this.context.fromName,\r\n            },\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"from_email\"]',\r\n                validate: (cb, val) => {\r\n                    const result = purchaseModel.senderEmail(val);\r\n\r\n                    cb(result);\r\n                },\r\n                errorMessage: this.context.fromEmail,\r\n            },\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"certificate_theme\"]:first-of-type',\r\n                triggeredBy: '#gift-certificate-form input[name=\"certificate_theme\"]',\r\n                validate: (cb) => {\r\n                    const val = $purchaseForm.find('input[name=\"certificate_theme\"]:checked').val();\r\n\r\n                    cb(typeof (val) === 'string');\r\n                },\r\n                errorMessage: this.context.certTheme,\r\n            },\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"agree\"]',\r\n                validate: (cb) => {\r\n                    const val = $purchaseForm.find('input[name=\"agree\"]').get(0).checked;\r\n\r\n                    cb(val);\r\n                },\r\n                errorMessage: this.context.agreeToTerms,\r\n            },\r\n            {\r\n                selector: '#gift-certificate-form input[name=\"agree2\"]',\r\n                validate: (cb) => {\r\n                    const val = $purchaseForm.find('input[name=\"agree2\"]').get(0).checked;\r\n\r\n                    cb(val);\r\n                },\r\n                errorMessage: this.context.agreeToTerms,\r\n            },\r\n        ]);\r\n\r\n        if ($certBalanceForm.length) {\r\n            const balanceVal = this.checkCertBalanceValidator($certBalanceForm);\r\n\r\n            $certBalanceForm.on('submit', () => {\r\n                balanceVal.performCheck();\r\n\r\n                if (!balanceVal.areAll('valid')) {\r\n                    return false;\r\n                }\r\n            });\r\n        }\r\n\r\n        $purchaseForm.on('submit', event => {\r\n            purchaseValidator.performCheck();\r\n\r\n            if (!purchaseValidator.areAll('valid')) {\r\n                return event.preventDefault();\r\n            }\r\n        });\r\n\r\n        $('#gift-certificate-preview').click(event => {\r\n            event.preventDefault();\r\n\r\n            purchaseValidator.performCheck();\r\n\r\n            if (!purchaseValidator.areAll('valid')) {\r\n                return;\r\n            }\r\n\r\n            const modal = defaultModal();\r\n            const previewUrl = `${$(event.currentTarget).data('previewUrl')}&${$purchaseForm.serialize()}`;\r\n\r\n            modal.open();\r\n\r\n            api.getPage(previewUrl, {}, (err, content) => {\r\n                if (err) {\r\n                    return modal.updateContent(this.context.previewError);\r\n                }\r\n\r\n                modal.updateContent(content, { wrap: true });\r\n            });\r\n        });\r\n    }\r\n\r\n    checkCertBalanceValidator($balanceForm) {\r\n        const balanceValidator = nod({\r\n            submit: $balanceForm.find('input[type=\"submit\"]'),\r\n        });\r\n\r\n        balanceValidator.add({\r\n            selector: $balanceForm.find('input[name=\"giftcertificatecode\"]'),\r\n            validate(cb, val) {\r\n                cb(giftCertChecker(val));\r\n            },\r\n            errorMessage: 'You must enter a certificate code.',\r\n        });\r\n\r\n        return balanceValidator;\r\n    }\r\n}\r\n","const forms = {\r\n    email(value) {\r\n        const re = /^.+@.+\\..+/;\r\n        return re.test(value);\r\n    },\r\n\r\n    /**\r\n     * Validates a password field\r\n     * @param value\r\n     * @returns {boolean}\r\n     */\r\n    password(value) {\r\n        return this.notEmpty(value);\r\n    },\r\n\r\n    /**\r\n     * validates if a field is empty\r\n     * @param value\r\n     * @returns {boolean}\r\n     *\r\n     */\r\n    notEmpty(value) {\r\n        return value.length > 0;\r\n    },\r\n};\r\n\r\nexport default forms;\r\n","const TRANSLATIONS = 'translations';\r\nconst isTranslationDictionaryNotEmpty = (dictionary) => !!Object.keys(dictionary[TRANSLATIONS]).length;\r\nconst chooseActiveDictionary = (...dictionaryJsonList) => {\r\n    for (let i = 0; i < dictionaryJsonList.length; i++) {\r\n        const dictionary = JSON.parse(dictionaryJsonList[i]);\r\n        if (isTranslationDictionaryNotEmpty(dictionary)) {\r\n            return dictionary;\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * defines Translation Dictionary to use\r\n * @param context provides access to 3 validation JSONs from en.json:\r\n * validation_messages, validation_fallback_messages and default_messages\r\n * @returns {Object}\r\n */\r\nexport const createTranslationDictionary = (context) => {\r\n    const { validationDictionaryJSON, validationFallbackDictionaryJSON, validationDefaultDictionaryJSON } = context;\r\n    const activeDictionary = chooseActiveDictionary(validationDictionaryJSON, validationFallbackDictionaryJSON, validationDefaultDictionaryJSON);\r\n    const localizations = Object.values(activeDictionary[TRANSLATIONS]);\r\n    const translationKeys = Object.keys(activeDictionary[TRANSLATIONS]).map(key => key.split('.').pop());\r\n\r\n    return translationKeys.reduce((acc, key, i) => {\r\n        acc[key] = localizations[i];\r\n        return acc;\r\n    }, {});\r\n};\r\n","export default function (cert) {\r\n    if (typeof cert !== 'string') {\r\n        return false;\r\n    }\r\n\r\n    // Add any custom gift certificate validation logic here\r\n    return true;\r\n}\r\n"],"sourceRoot":""}